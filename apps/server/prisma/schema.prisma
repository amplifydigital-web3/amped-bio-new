generator client {
  provider = "prisma-client-js"
  output   = "../src/lib/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id                 Int                 @id @default(autoincrement())
  name               String
  email              String              @unique
  handle             String?             @unique @map("littlelink_name")
  description        String?             @map("littlelink_description") @db.LongText
  role               String              @default("user")
  block              String              @default("no")
  theme              String?
  image              String?             @db.LongText
  image_file_id      Int?
  reward_business_id String?
  created_at         DateTime            @default(now())
  updated_at         DateTime?           @updatedAt
  email_verified     Boolean             @default(false) @map("email_verified")
  accounts           Account[]
  blocks             Block[]
  confirmationCodes  ConfirmationCode[]
  oauthaccesstokens  OauthAccessToken[]
  oauthclients       OauthClient[]
  oauthconsents      OauthConsent[]
  oauthrefreshtokens OauthRefreshToken[]
  sessions           Session[]
  themes             Theme[]
  uploadedFiles      UploadedFile[]
  wallet             UserWallet?
  profileImage       UploadedFile?       @relation("UserProfileImage", fields: [image_file_id], references: [id])

  @@index([image_file_id], map: "users_image_file_id_fkey")
  @@map("users")
}

model Session {
  id                 Int                 @id @default(autoincrement())
  expiresAt          DateTime
  token              String              @unique
  createdAt          DateTime
  updatedAt          DateTime
  ipAddress          String?
  userAgent          String?
  userId             Int
  oauthaccesstokens  OauthAccessToken[]
  oauthrefreshtokens OauthRefreshToken[]
  user               User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId], map: "session_userId_fkey")
  @@map("session")
}

model Account {
  id                    Int       @id @default(autoincrement())
  accountId             String
  providerId            String
  userId                Int
  accessToken           String?   @db.LongText
  refreshToken          String?
  idToken               String?   @db.LongText
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime
  updatedAt             DateTime
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId], map: "account_userId_fkey")
  @@map("account")
}

model Verification {
  id         Int       @id @default(autoincrement())
  identifier String
  value      String    @db.LongText
  expiresAt  DateTime
  createdAt  DateTime?
  updatedAt  DateTime?

  @@map("verification")
}

model ThemeCategory {
  id            Int           @id @default(autoincrement())
  name          String        @unique
  title         String
  category      String
  description   String?
  visible       Boolean       @default(false)
  image_file_id Int?
  created_at    DateTime      @default(now())
  updated_at    DateTime?     @updatedAt
  categoryImage UploadedFile? @relation("ThemeCategoryImage", fields: [image_file_id], references: [id])
  themes        Theme[]

  @@index([image_file_id], map: "theme_categories_image_file_id_fkey")
  @@map("theme_categories")
}

model Theme {
  id                Int            @id @default(autoincrement())
  user_id           Int?
  share_level       String         @default("private")
  share_config      String?        @db.LongText
  name              String?
  description       String?        @db.LongText
  config            String?        @db.LongText
  category_id       Int?
  thumbnail_file_id Int?
  created_at        DateTime       @default(now())
  updated_at        DateTime?      @updatedAt
  category          ThemeCategory? @relation(fields: [category_id], references: [id])
  thumbnailImage    UploadedFile?  @relation("ThemeThumbnailImage", fields: [thumbnail_file_id], references: [id])
  user              User?          @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([category_id], map: "themes_category_id_fkey")
  @@index([thumbnail_file_id], map: "themes_thumbnail_file_id_fkey")
  @@index([user_id], map: "themes_user_id_fkey")
  @@map("themes")
}

model Block {
  id         Int       @id @default(autoincrement())
  user_id    Int
  type       String    @db.VarChar(255)
  order      Int       @default(0)
  clicks     Int       @default(0)
  config     String?   @db.LongText
  created_at DateTime  @default(now())
  updated_at DateTime? @updatedAt
  user       User      @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id], map: "blocks_user_id_fkey")
  @@map("blocks")
}

model ConfirmationCode {
  id        Int                  @id @default(autoincrement())
  code      String               @db.Char(6)
  type      ConfirmationCodeType
  userId    Int
  used      Boolean              @default(false)
  expiresAt DateTime
  createdAt DateTime             @default(now())
  updatedAt DateTime?            @updatedAt
  user      User                 @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([code])
  @@index([userId], map: "confirmation_codes_userId_fkey")
  @@map("confirmation_codes")
}

model UploadedFile {
  id                  Int             @id @default(autoincrement())
  s3_key              String          @db.VarChar(255)
  bucket              String          @db.VarChar(100)
  file_name           String          @db.VarChar(255)
  file_type           String?         @db.VarChar(100)
  size                BigInt?
  user_id             Int?
  uploaded_at         DateTime        @default(now())
  status              FileStatus      @default(PENDING)
  created_at          DateTime        @default(now())
  updated_at          DateTime?       @updatedAt
  creatorPoolImage    CreatorPool[]   @relation("CreatorPoolImage")
  themeCategoryImage  ThemeCategory[] @relation("ThemeCategoryImage")
  themeThumbnailImage Theme[]         @relation("ThemeThumbnailImage")
  user                User?           @relation(fields: [user_id], references: [id], onDelete: Cascade)
  userProfileImage    User[]          @relation("UserProfileImage")

  @@index([s3_key])
  @@index([user_id])
  @@index([status])
  @@map("uploaded_files")
}

model UserWallet {
  id                   Int           @id @default(autoincrement())
  address              String        @unique
  userId               Int           @unique
  last_airdrop_request DateTime?
  created_at           DateTime      @default(now())
  updated_at           DateTime?     @updatedAt
  creatorPools         CreatorPool[]
  stakeEvents          StakeEvent[]
  stakedPools          StakedPool[]
  user                 User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_wallets")
}

model CreatorPool {
  id            Int           @id @default(autoincrement())
  walletId      Int
  chainId       String
  image_file_id Int?
  description   String?       @db.LongText
  fans          Int           @default(0)
  revoStaked    String        @db.Text
  poolAddress   String?       @unique
  hidden        Boolean?      @default(false)
  poolImage     UploadedFile? @relation("CreatorPoolImage", fields: [image_file_id], references: [id])
  wallet        UserWallet    @relation(fields: [walletId], references: [id], onDelete: Cascade)
  stakeEvents   StakeEvent[]
  stakedPools   StakedPool[]

  @@unique([walletId, chainId])
  @@index([image_file_id], map: "creator_pools_image_file_id_fkey")
  @@map("creator_pools")
}

model SiteSettings {
  setting_key   String           @id
  setting_value String           @db.LongText
  value_type    SettingValueType

  @@map("site_settings")
}

model StakedPool {
  id           Int         @id @default(autoincrement())
  userWalletId Int
  poolId       Int
  stakeAmount  String      @db.Text
  createdAt    DateTime    @default(now())
  updatedAt    DateTime?   @updatedAt
  pool         CreatorPool @relation(fields: [poolId], references: [id], onDelete: Cascade)
  userWallet   UserWallet  @relation(fields: [userWalletId], references: [id], onDelete: Cascade)

  @@unique([userWalletId, poolId])
  @@index([poolId], map: "staked_pools_poolId_fkey")
  @@map("staked_pools")
}

model StakeEvent {
  id              Int         @id @default(autoincrement())
  userWalletId    Int
  poolId          Int
  amount          String      @db.Text
  eventType       String
  transactionHash String
  createdAt       DateTime    @default(now())
  pool            CreatorPool @relation(fields: [poolId], references: [id], onDelete: Cascade)
  userWallet      UserWallet  @relation(fields: [userWalletId], references: [id], onDelete: Cascade)

  @@unique([transactionHash, userWalletId, poolId])
  @@index([poolId], map: "stake_events_poolId_fkey")
  @@index([userWalletId], map: "stake_events_userWalletId_fkey")
  @@map("stake_events")
}

model Jwks {
  id         Int       @id @default(autoincrement())
  publicKey  String    @db.LongText
  privateKey String    @db.LongText
  createdAt  DateTime  @default(now())
  expiresAt  DateTime?

  @@map("jwks")
}

model OauthClient {
  id                      Int                 @id @default(autoincrement())
  clientId                String              @unique
  clientSecret            String?             @db.Text
  disabled                Boolean?            @default(false)
  skipConsent             Boolean?
  enableEndSession        Boolean?
  scopes                  String?
  userId                  Int?
  createdAt               DateTime?
  updatedAt               DateTime?
  name                    String?             @db.Text
  uri                     String?             @db.Text
  icon                    String?             @db.Text
  contacts                String?
  tos                     String?             @db.Text
  policy                  String?             @db.Text
  softwareId              String?             @db.Text
  softwareVersion         String?             @db.Text
  softwareStatement       String?             @db.Text
  redirectUris            String
  postLogoutRedirectUris  String?
  tokenEndpointAuthMethod String?             @db.Text
  grantTypes              String?
  responseTypes           String?
  public                  Boolean?
  type                    String?             @db.Text
  referenceId             String?             @db.Text
  metadata                String?
  oauthaccesstokens       OauthAccessToken[]
  user                    User?               @relation(fields: [userId], references: [id], onDelete: Cascade)
  oauthconsents           OauthConsent[]
  oauthrefreshtokens      OauthRefreshToken[]

  @@index([userId], map: "oauthClient_userId_fkey")
  @@map("oauthClient")
}

model OauthRefreshToken {
  id                Int                @id @default(autoincrement())
  token             String             @db.Text
  clientId          String
  sessionId         Int?
  userId            Int
  referenceId       String?            @db.Text
  expiresAt         DateTime?
  createdAt         DateTime?
  revoked           DateTime?
  scopes            String
  oauthaccesstokens OauthAccessToken[]
  oauthclient       OauthClient        @relation(fields: [clientId], references: [clientId], onDelete: Cascade)
  session           Session?           @relation(fields: [sessionId], references: [id])
  user              User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([clientId], map: "oauthRefreshToken_clientId_fkey")
  @@index([sessionId], map: "oauthRefreshToken_sessionId_fkey")
  @@index([userId], map: "oauthRefreshToken_userId_fkey")
  @@map("oauthRefreshToken")
}

model OauthAccessToken {
  id                Int                @id @default(autoincrement())
  token             String?            @unique
  clientId          String
  sessionId         Int?
  userId            Int?
  referenceId       String?            @db.Text
  refreshId         Int?
  expiresAt         DateTime?
  createdAt         DateTime?
  scopes            String
  oauthclient       OauthClient        @relation(fields: [clientId], references: [clientId], onDelete: Cascade)
  oauthrefreshtoken OauthRefreshToken? @relation(fields: [refreshId], references: [id], onDelete: Cascade)
  session           Session?           @relation(fields: [sessionId], references: [id])
  user              User?              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([clientId], map: "oauthAccessToken_clientId_fkey")
  @@index([refreshId], map: "oauthAccessToken_refreshId_fkey")
  @@index([sessionId], map: "oauthAccessToken_sessionId_fkey")
  @@index([userId], map: "oauthAccessToken_userId_fkey")
  @@map("oauthAccessToken")
}

model OauthConsent {
  id          Int         @id @default(autoincrement())
  clientId    String
  userId      Int?
  referenceId String?     @db.Text
  scopes      String
  createdAt   DateTime?
  updatedAt   DateTime?
  oauthclient OauthClient @relation(fields: [clientId], references: [clientId], onDelete: Cascade)
  user        User?       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([clientId], map: "oauthConsent_clientId_fkey")
  @@index([userId], map: "oauthConsent_userId_fkey")
  @@map("oauthConsent")
}

enum ConfirmationCodeType {
  EMAIL_CONFIRMATION
  EMAIL_CHANGE
  PASSWORD_RESET
}

enum FileStatus {
  PENDING
  COMPLETED
  DELETED
}

enum SettingValueType {
  STRING
  NUMBER
  BOOLEAN
  JSON
}
